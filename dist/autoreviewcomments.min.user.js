/*

// ==UserScript==
// @name           AutoReviewComments
// @namespace      benjol
// @version        1.3.3.1
// @description    No more re-typing the same comments over and over!
// @homepage       https://github.com/Benjol/SE-AutoReviewComments
// @grant          none
// @include http*://*stackoverflow.com/questions*
// @include http*://*stackoverflow.com/review*
// @include http*://*stackoverflow.com/admin/dashboard*
// @include http*://*stackoverflow.com/tools*
// @include http*://*serverfault.com/questions*
// @include http*://*serverfault.com/review*
// @include http*://*serverfault.com/admin/dashboard*
// @include http*://*serverfault.com/tools*
// @include http*://*superuser.com/questions*
// @include http*://*superuser.com/review*
// @include http*://*superuser.com/admin/dashboard*
// @include http*://*superuser.com/tools*
// @include http*://*stackexchange.com/questions*
// @include http*://*stackexchange.com/review*
// @include http*://*stackexchange.com/admin/dashboard*
// @include http*://*stackexchange.com/tools*
// @include http*://*askubuntu.com/questions*
// @include http*://*askubuntu.com/review*
// @include http*://*askubuntu.com/admin/dashboard*
// @include http*://*askubuntu.com/tools*
// @include http*://*answers.onstartups.com/questions*
// @include http*://*answers.onstartups.com/review*
// @include http*://*answers.onstartups.com/admin/dashboard*
// @include http*://*answers.onstartups.com/tools*
// @include http*://*mathoverflow.net/questions*
// @include http*://*mathoverflow.net/review*
// @include http*://*mathoverflow.net/admin/dashboard*
// @include http*://*mathoverflow.net/tools*
// @include http*://discuss.area51.stackexchange.com/questions/*
// @include http*://discuss.area51.stackexchange.com/review*
// @include http*://discuss.area51.stackexchange.com/admin/dashboard*
// @include http*://discuss.area51.stackexchange.com/tools*
// @include http*://stackapps.com/questions*
// @include http*://stackapps.com/review*
// @include http*://stackapps.com/admin/dashboard*
// @include http*://stackapps.com/tools*
// ==/UserScript==
*/
function with_jquery(e){var t=document.createElement("script");t.type="text/javascript";t.textContent="("+e.toString()+")(jQuery)";document.body.appendChild(t)}
with_jquery(function(e){StackExchange.ready(function(){function t(a){window.AutoReviewComments_AutoUpdateCallback=function(b){b>v&&a(b,v,F)};e("<script />").attr("src",F).appendTo("head")}function G(a){var b=(new Date).setHours(0,0,0,0),d=f("LastUpdateCheckDay");null==d?H(a,"Please read this!",'Thanks for installing this script.                             Please note that you can EDIT the texts inline by double-clicking them.                             For other options, please see the README at <a href="https://github.com/Benjol/SE-AutoReviewComments" target="_blank">here</a>.',function(){}):
d!=b&&t(function(b,d,e){b!=f("LastVersionAcknowledged")&&H(a,"New Version!","A new version ("+b+') of the <a href="http://stackapps.com/q/2116">AutoReviewComments</a> userscript is now available, see the <a href="https://github.com/Benjol/SE-AutoReviewComments/releases">release notes</a> for details or <a href="'+e+'">click here</a> to install now.',function(){h("LastVersionAcknowledged",b)})});h("LastUpdateCheckDay",b)}function f(a){return localStorage[A+a]}function h(a,b){localStorage[A+a]=b}function p(a){for(var b=
localStorage.length-1;0<=b;b--){var d=localStorage.key(b);0==d.indexOf(A+a)&&localStorage.removeItem(d)}}function T(a){var b=new Date/1E3,d=(new Date).setHours(0,0,0)/1E3,d=b-d,b=b-a;if(b<I)return Math.round(b)+" seconds ago";if(b<J)return Math.round(b/I)+" minutes ago";if(b<d)return Math.round(b/J)+" hours ago";if(b<K+d)return"yesterday";a=new Date(1E3*a);return b<L?"on "+M[a.getDay()]:a.toDateString()}function U(a){if(1E4>a)return a;if(1E5>a){var b=Math.floor(Math.round(a/100)/10);a=Math.round((a-
1E3*b)/100);return b+(0<a?"."+a:"")+"k"}return Math.round(a/1E3)+"k"}function V(a){a=a.parents("div").find(".post-signature:last").first().find(".user-details > a:not([id])");return a.length?a.attr("href").split("/")[2]:"[NULL]"}function W(){var a=e("#question").find(".owner").find(".user-details > a:not([id])");if(a.length)return a.text();a=e("#question").find(".owner").find(".user-details");return a.length?a.text():"[NULL]"}function X(a,b){var d=b.find("#userinfo");isNaN(a)?d.fadeOutAndRemove():
e.ajax({type:"GET",url:location.protocol+"//api.stackexchange.com/2.2/users/"+a+"?site="+w+"&jsonp=?",dataType:"jsonp",timeout:2E3,success:function(c){if(0<c.items.length){c=c.items[0];new Date/1E3-c.creation_date<x&&(u=!0,b.find(".action-desc").prepend(q));B=c.display_name;var e=c.user_type.charAt(0).toUpperCase()+c.user_type.slice(1)+' user <strong><a href="/users/'+a+'" target="_blank">'+B+"</a></strong>,                                 member <strong>",g=c.creation_date,k=new Date/1E3,Y=new Date(1E3*
g),f=(new Date).setHours(0,0,0)/1E3,f=k-f,g=k-g,k="";g<f?k="since today":g<K+f?k="since yesterday":g<L?k="since "+M[Y.getDay()]:g>y?(k="for "+Math.round(g/y)+" years",g%y>r&&(k+=", "+Math.round(g%y/r)+" months")):g>r?(k="for "+Math.round(g/r)+" months",g%r>x&&(k+=", "+Math.round(g%r/x)+" weeks")):k="for "+Math.round(g/x)+" weeks";c=e+k+"</strong>,                                                                    last seen <strong>"+T(c.last_access_date)+"</strong>,                                                              reputation <strong>"+
U(c.reputation)+"</strong>";d.html(c.replace(/ +/g," "))}else d.fadeOutAndRemove()},error:function(){d.fadeOutAndRemove()}})}function Z(a){var b=a.find("#main"),d=e('<div><textarea/><a class="jsonp">jsonp</a><span class="lsep"> | </span><a class="save">save</a><span class="lsep"> | </span><a class="cancel">cancel</a></div>');d.css({position:"absolute",left:b.position().left,top:b.position().top,width:b.css("width"),height:b.css("height"),background:"white"});for(var b="",c=0;c<f("commentcount");c++)var l=
f("name-"+c),g=f("desc-"+c),b=b+("###"+l+"\n"+C(g)+"\n\n");d.find("textarea").width("100%").height("95%").val(b);d.find(".jsonp").click(function(){for(var a="callback(\n[\n",b=0;b<f("commentcount");b++)a+='{ "name": "'+f("name-"+b)+'", "description": "'+f("desc-"+b).replace(/"/g,'\\"')+'"},\n\n';d.find("textarea").val(a+"]\n)");d.find("a:lt(2)").remove();d.find(".lsep:lt(2)").remove()});d.find(".cancel").click(function(){d.fadeOutAndRemove()});d.find(".save").click(function(){var b=d.find("textarea").val();
p("name-");p("desc-");for(var b=b.split("\n"),c=0,g=0,f=0;f<b.length;f++){var l=e.trim(b[f]);0==l.indexOf("#")?(l=l.replace(/^#+/g,""),h("name-"+c,l),c++):0<l.length&&(l=D(l),h("desc-"+g,E(l)),g++)}h("commentcount",Math.min(c,g));s(a);d.fadeOutAndRemove()});a.append(d)}function C(a){markdown=a.replace(/<a href="(.+?)">(.+?)<\/a>/g,"[$2]($1)").replace(/&amp;/g,"&");return markdown.replace(/<em>(.+?)<\/em>/g,"*$1*").replace(/<strong>(.+?)<\/strong>/g,"**$1**")}function D(a){html=a.replace(/\[([^\]]+)\]\((.+?)\)/g,
'<a href="$2">$1</a>');return html.replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>").replace(/\*([^`]+?)\*/g,"<em>$1</em>")}function E(a){var b=RegExp("http://"+w,"g"),d=RegExp("/"+z+"[)]","g");return a.replace(RegExp(m,"g"),"$SITENAME$").replace(b,"http://$SITEURL$").replace(d,"/$MYUSERID$)")}function $(a){var b=a.html(),d=E(a.html().replace(q,""));if(!(-1<d.indexOf("<textarea"))){d=e("<textarea />").css("height",2*a.height()).css("width",a.css("width")).val(C(d));a.parent("label").attr("for","borken");
var c=e("<a>save</a>").click(function(){var b=e(this).parent(),c=D(b.find("textarea").val());h(b.attr("id"),E(c));b.html((u?q:"")+c.replace(/\$SITENAME\$/g,m).replace(/\$SITEURL\$/g,w).replace(/\$MYUSERID\$/g,z));N(a)}).add('<span class="lsep"> | </span>').add(e("<a>cancel</a>").click(function(){e(this).parent().html(b);N(a)}));a.html(d.add(c))}}function N(a){a=a.parent("label");a.attr("for",a.prev().attr("id"))}function O(){p("name-");p("desc-");e.each(P,function(a,b){h("name-"+a,b.Name);h("desc-"+
a,b.Description)});h("commentcount",P.length)}function s(a){f("commentcount")||O();var b=a.find(".action-list");b.empty();for(var d=0;d<f("commentcount");d++){var c;c=f("name-"+d);c=-1<c.indexOf("[Q]")?"question":-1<c.indexOf("[A]")?"answer":"any";if("any"==c||c==a.posttype)c=f("desc-"+d).replace(/\$SITENAME\$/g,m).replace(/\$SITEURL\$/g,w).replace(/\$MYUSERID\$/g,z).replace(/\$/g,"$$$"),c=aa.replace(/\$ID\$/g,d).replace("$NAME$",f("name-"+d).replace(/\$/g,"$$$")).replace("$DESCRIPTION$",(u?q:"")+
c),b.append(c)}Q(a);ba(a)}function ba(a){a.find("label > span").dblclick(function(){$(e(this))});a.find("input:radio").click(function(){a.find(".popup-submit").removeAttr("disabled");e(this).parents("ul").find(".action-selected").removeClass("action-selected");"hide"==f("hide-desc")&&e(this).parents("ul").find(".action-desc").hide();e(this).parent().addClass("action-selected").find(".action-desc").show()});a.find("input:radio").keyup(function(b){13==b.which&&(b.preventDefault(),a.find(".popup-submit").trigger("click"))})}
function Q(a){a=a.find("ul.action-list li:not(.action-selected) span[id*='desc-']");"hide"==f("hide-desc")?a.hide():a.show()}function H(a,b,d,c){d=d.replace(/\n/g,"<BR/>");b=e(ca.replace("$TITLE$",b).replace("$BODY$",d));b.find(".notify-close").click(function(){e(this).parent().fadeOutAndRemove();c()});a.find("h2").before(b)}function da(a,b,d){e.ajax({type:"GET",url:a+"?jsonp=?",dataType:"jsonp",jsonpCallback:"callback",timeout:2E3,success:b,error:d,async:!1})}function R(a,b,d){da(a,function(a){h("commentcount",
a.length);p("name-");p("desc-");e.each(a,function(a,b){h("name-"+a,b.name);h("desc-"+a,D(b.description))});b()},d)}function ea(a){var b=a.find("#remote-popup"),d=b.find("#remoteerror1"),c=b.find("#remoteurl"),e=b.find("#remoteauto"),g=b.find("#throbber1");a.find(".popup-actions-remote").click(function(){c.val(f("RemoteUrl"));e.prop("checked","true"==f("AutoRemote"));b.show()});a.find(".remote-cancel").click(function(){g.hide();d.text("");b.hide()});a.find(".remote-save").click(function(){h("RemoteUrl",
c.val());h("AutoRemote",e.prop("checked"));b.hide()});a.find(".remote-get").click(function(){g.show();R(c.val(),function(){s(a);g.hide()},function(a,b){d.text(b)})})}function fa(a){var b=a.find("#welcome-popup"),d=b.find("#customwelcome");a.find(".popup-actions-welcome").click(function(){d.val(q);b.show()});a.find(".welcome-cancel").click(function(){b.hide()});a.find(".welcome-force").click(function(){u=!0;s(a);b.hide()});a.find(".welcome-save").click(function(){var a=""==d.val()?"NONE":d.val();h("WelcomeMessage",
a);q=d.val();b.hide()})}var v="1.3.3.1",F="https://raw.github.com/Benjol/SE-AutoReviewComments/master/dist/autoreviewcomments.user.js",n;for(n in window)if(-1!=n.indexOf("selfUpdaterCallback")){window[n](v);return}if(window.AutoReviewComments_AutoUpdateCallback)window.AutoReviewComments_AutoUpdateCallback(v);else{var w=window.location.hostname;n=document.title.split(" - ");var m=n[n.length-1],B="user",S="OP",A="AutoReviewComments-",z;z=document.getElementsByClassName("profile-me")[0].href.match(/\/users\/(\d+)\/.*/i)?
RegExp.$1:"";"Stack Exchange"==m&&(m=n[n.length-2]);m=m.replace(/ ?Stack Exchange/,"");f("WelcomeMessage")||h("WelcomeMessage","Welcome to "+m+"! ");var q="NONE"==f("WelcomeMessage")?"":f("WelcomeMessage"),u=!1,ca='<div id="announcement" style="background:orange;padding:7px;margin-bottom:10px;font-size:15px"> <span class="notify-close" style="border:2px solid black;cursor:pointer;display:block;float:right;margin:0 4px;padding:0 4px;line-height:17px"> <a title="dismiss this notification" style="color:black;text-decoration:none;font-weight:bold;font-size:16px">x</a> </span> <strong>$TITLE$</strong> $BODY$ </div>',
aa='<li> <input id="comment-$ID$" type="radio" name="commentreview"/> <label for="comment-$ID$"> <span id="name-$ID$" class="action-name">$NAME$</span> <span id="desc-$ID$" class="action-desc">$DESCRIPTION$</span> </label> </li>',P=[{Name:"Answers just to say Thanks!",Description:'Please don\'t add "thanks" as answers. Invest some time in the site and you will gain sufficient <a href="http://$SITEURL$/privileges">privileges</a> to upvote answers you like, which is the $SITENAME$ way of saying thank you.'},
{Name:"Nothing but a URL (and isn't spam)",Description:'Whilst this may theoretically answer the question, <a href="http://meta.stackoverflow.com/q/8259">it would be preferable</a> to include the essential parts of the answer here, and provide the link for reference.'},{Name:"Requests to OP for further information",Description:"This is really a comment, not an answer. With a bit more rep, <a href=\"http://$SITEURL$/privileges/comment\">you will be able to post comments</a>. For the moment I've added the comment for you, and I'm flagging this post for deletion."},
{Name:"OP using an answer for further information",Description:"Please use the <em>Post answer</em> button only for actual answers. You should modify your original question to add additional information."},{Name:"OP adding a new question as an answer",Description:'If you have another question, please ask it by clicking the <a href="http://$SITEURL$/questions/ask">Ask Question</a> button.'},{Name:"Another user adding a 'Me too!'",Description:'If you have a NEW question, please ask it by clicking the <a href="http://$SITEURL$/questions/ask">Ask Question</a> button. If you have sufficient reputation, <a href="http://$SITEURL$/privileges/vote-up">you may upvote</a> the question. Alternatively, "star" it as a favorite and you will be notified of any new answers.'}],
M="Sunday Monday Tuesday Wednesday Thursday Friday Saturday".split(" "),I=60,J=3600,K=86400,L=518400,x=604800,r=2592E3,y=31536E3;e("#content").delegate(".comments-link","click",function(){var a=e(this).attr("id").replace("-link",""),b=e(this).parents(".question, .answer").attr("class").split(" ")[0];if(!(0<e("#"+a).find(".comment-auto-link").length)){var d=e('<span class="lsep"> | </span>').add(e('<a class="comment-auto-link">auto</a>').click(function(){var c=e('<div id="popup" class="popup" style="width:690px; position: absolute; display: block"> <div id="close" class="popup-close"><a title="close this popup (or hit Esc)">&#215;</a></div> <h2 class="handle">Which review comment to insert?</h2> <div style="overflow:hidden" id="main"> <div class="popup-active-pane"> <div id="userinfo" style="padding:5px;background:#EAEFEF"> <img src="http://sstatic.net/img/progress-dots.gif"/> </div> <ul class="action-list" style="height:440;overflow-y:auto"> </ul> </div> <div style="display:none" class="share-tip" id="remote-popup"> enter url for remote source of comments (use import/export to create jsonp) <input id="remoteurl" type="text" style="display: block; width: 400px;"/> <img id="throbber1" style="display:none" src="http://sstatic.net/img/progress-dots.gif"/> <span id="remoteerror1" style="color:red"/> <div style="float:left"> <input type="checkbox" id="remoteauto"/> <label title="get from remote on every page refresh" for="remoteauto">auto-get</label> </div> <div style="float:right"> <a class="remote-get">get now</a> <span class="lsep"> | </span> <a class="remote-save">save</a> <span class="lsep"> | </span> <a class="remote-cancel">cancel</a> </div> </div> <div style="display:none" class="share-tip" id="welcome-popup"> configure "welcome" message (empty=none): <div> <input id="customwelcome" type="text" style="width: 300px;"/> </div> <div style="float:right"> <a class="welcome-force">force</a> <span class="lsep"> | </span> <a class="welcome-save">save</a> <span class="lsep"> | </span> <a class="welcome-cancel">cancel</a> </div> </div> <div class="popup-actions"> <div style="float: left; margin-top: 18px;"> <a title="close this popup (or hit Esc)" class="popup-actions-cancel">cancel</a> <span class="lsep"> | </span> <a title="see info about this popup" class="popup-actions-help" href="http://stackapps.com/q/2116" target="_blank">info</a> <span class="lsep"> | </span> <a class="popup-actions-see">see-through</a> <span class="lsep"> | </span> <a title="reset any custom comments" class="popup-actions-reset">reset</a> <span class="lsep"> | </span> <a title="use this to import/export all comments" class="popup-actions-impexp">import/export</a> <span class="lsep"> | </span> <a title="use this to hide/show all comments" class="popup-actions-toggledesc">show/hide desc</a> <span class="lsep"> | </span> <a title="setup remote source" class="popup-actions-remote">remote</a> <img id="throbber2" style="display:none" src="http://sstatic.net/img/progress-dots.gif"/> <span id="remoteerror2" style="color:red"/> <span class="lsep"> | </span> <a title="configure welcome" class="popup-actions-welcome">welcome</a> </div> <div style="float:right;"> <input class="popup-submit" type="button" disabled="disabled" style="float:none; margin-left: 5px" value="Insert"> </div> </div> </div> </div>');
c.find(".popup-close").click(function(){c.fadeOutAndRemove()});c.posttype=b;u=!1;s(c);c.find(".popup-actions-cancel").click(function(){c.fadeOutAndRemove()});c.find(".popup-actions-reset").click(function(){O();s(c)});c.find(".popup-actions-see").hover(function(){c.fadeTo("fast","0.4").children().not("#close").fadeTo("fast","0.0")},function(){c.fadeTo("fast","1.0").children().not("#close").fadeTo("fast","1.0")});c.find(".popup-actions-impexp").click(function(){Z(c)});c.find(".popup-actions-toggledesc").click(function(){var a=
f("hide-desc")||"show";h("hide-desc","show"==a?"hide":"show");Q(c)});ea(c);fa(c);c.find(".popup-submit").click(function(){var b=c.find("input:radio:checked"),b=C(b.parent().find(".action-desc").html()).replace(/\[username\]/g,B).replace(/\[OP\]/g,S);e("#"+a).find("textarea").val(b).focus();b=b.indexOf("[type here]");0<=b&&e("#"+a).find("textarea")[0].setSelectionRange(b,b+11);c.fadeOutAndRemove()});if(!window.VersionChecked&&"true"==f("AutoRemote")){var d=c.find("#throbber2"),g=c.find("#remoteerror2");
d.show();R(f("RemoteUrl"),function(){s(c);d.hide()},function(a,b){g.text(b)})}e("#"+a).append(c);c.center();StackExchange.helpers.bindMovablePopups();var k=V(e(this));X(k,c);S=W();"function"!=typeof G||window.VersionChecked||(G(c),window.VersionChecked=!0)}));setTimeout(function(){e("#"+a).find(".comment-help-link").parent().append(d)},15)}})}})});
